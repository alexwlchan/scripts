#!/usr/bin/env python3
"""
Adds a white border of consistent width around an image.

I use it when I've taken a screenshot of something on a white background,
and I want to tidy up the crop quickly.
"""

import itertools
import os
import sys

from PIL import Image, ImageChops, ImageOps


if __name__ == '__main__':
    try:
        path = sys.argv[1]
        border_width = int(sys.argv[2])
    except (IndexError, ValueError):
        sys.exit(f"Usage: {__file__} <PATH> <BORDER_WIDTH>")

    im = Image.open(path)

    bg = Image.new(im.mode, im.size, (255, 255, 255))

    diff = ImageChops.difference(im, bg)
    diff = ImageChops.add(diff, diff, 2.0, -100)
    bbox = diff.getbbox()
    if bbox:
        im = im.crop(bbox)

    im = ImageOps.expand(im, border=border_width, fill='white')

    name, ext = os.path.splitext(path)

    out_path = f'{name}.reborder_{border_width}{ext}'

    im.save(out_path)

    print(out_path)
